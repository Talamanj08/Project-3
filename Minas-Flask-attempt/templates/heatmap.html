<!DOCTYPE html>
<html>
<head>
    <title>Heatmap</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #map {
            position: absolute;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <h1>Heatmap</h1>
    <div id="map"></div>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script>
        var heatmapData = JSON.parse('{{ heatmap_data|safe }}');

        // Create the SVG container
        var svg = d3.select("#map")
            .append("svg")
            .attr("width", "100%")
            .attr("height", "100%");

        // Define the map projection
        var projection = d3.geoAlbersUsa()
            .translate([svg.attr("width") / 2, svg.attr("height") / 2])
            .scale(1000);

        // Load the map data
        d3.json("path/to/map.json").then(function(mapData) {
            // Create a path generator
            var path = d3.geoPath().projection(projection);

            // Draw the map features
            svg.selectAll("path")
                .data(mapData.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill", "lightgray")
                .style("stroke", "white")
                .style("stroke-width", 0.5);

            // Visualize the heatmap
            svg.selectAll("circle")
                .data(heatmapData)
                .enter()
                .append("circle")
                .attr("cx", function(d) { return projection([d.longitude, d.latitude])[0]; })
                .attr("cy", function(d) { return projection([d.longitude, d.latitude])[1]; })
                .attr("r", function(d) { return d.value * 10; })
                .style("fill", function(d) { return "rgba(255, 0, 0, " + (d.value * 0.5) + ")"; });
        });
    </script>
</body>
</html>
